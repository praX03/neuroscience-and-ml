!function(){function t(t,n,a,r){z=a,P=r,g=-1!==z.tax.indexOf(R)?z.tax.indexOf(R):0,f=-1!==z.fax.indexOf(G)?z.fax.indexOf(G):0,T=n;var l=d3.select("#SubjectDropdown"),i=l.selectAll(".dropdown-menu").selectAll("li").data(T);i.enter().append("li").attr("id",function(t){return t.subjectID}).attr("role","presentation").append("a").attr("role","menuitem").attr("tabindex",-1).text(function(t){return t.subjectID}),s=s||T[0].subjectID,l.selectAll("button").text(s).append("span").attr("class","caret");var c=d3.select("#EdgeStatTypeDropdown"),o=c.select("ul").selectAll("li").data(P);o.enter().append("li").attr("id",function(t){return t.edgeStatID}).append("a").attr("role","menuitem").attr("tabindex",-1).text(function(t){return t.edgeStatName}),o.exit().remove(),d=d||P[0].edgeStatID,q=P.filter(function(t){return t.edgeStatID===d})[0].edgeStatName,c.selectAll("button").text(q).append("span").attr("class","caret"),d3.selectAll("#legendKey").selectAll("#anatomicalLegend").selectAll("svg").attr("height",14+15.14*z.brainRegions.length),e()}function e(){var t="channels_"+s+".json";o=T.filter(function(t){return t.subjectID===s})[0];var e=o.brainXpixels/o.brainYpixels;l=document.getElementById("NetworkPanel").offsetWidth-N.left-N.right,i=document.getElementById("NetworkPanel").offsetWidth*(1/e)-N.top-N.bottom,c=d3.select("#NetworkPanel").selectAll("svg").data([o],function(t){return t.subjectID}),c.exit().remove(),c=c.enter().append("svg").attr("width",l).attr("height",i).append("g"),L.spin(document.getElementById("NetworkPanel")),c.style("display","none"),d3.json("DATA/"+t,function(t,e){F=e,u=u||F[0].channelID,p=p||F[1].channelID,n()})}function n(){var t="edges_"+s+"_"+d+".json";d3.json("DATA/"+t,function(t,e){H=e,a()})}function a(){_.spin(document.getElementById("SpectraCh1Panel")),B.spin(document.getElementById("SpectraCh2Panel")),E.spin(document.getElementById("EdgeStatPanel")),x.style("display","none"),v.style("display","none"),y.style("display","none"),k.style("display","none");var t="spectrogram_"+s+"_"+u+".json",e="spectrogram_"+s+"_"+p+".json";queue().defer(d3.json,"DATA/"+t).defer(d3.json,"DATA/"+e).await(r)}function r(t,r,T){function N(){St=d3.select("#timeSlider"),kt=d3.select("#timeSlider-value"),wt=d3.select("#freqSlider"),Dt=d3.select("#freqSlider-value"),Et=d3.round(xt[1]-xt[0],4),jt=xt.length-1,St.property("min",d3.min(xt)),St.property("max",d3.max(xt)),St.property("step",Et),St.property("value",xt[g]),St.on("input",it),kt.text(xt[g]+" ms"),wt.property("min",d3.min(yt)),wt.property("max",d3.max(yt)),wt.property("step",yt[1]-yt[0]),wt.property("value",yt[f]),wt.on("input",ct),Dt.text(yt[f]+" Hz")}function R(){function t(t,n){return Math.abs(t)>=Math.abs(n)?n=Math.abs(t):t=-1*n,e(t,n,11)}function e(t,e,n){if("undefined"==typeof n&&(n=Math.max(Math.round(e-t)+1,1)),2>n)return 1===n?[t]:[];var a,r=Array(n);for(n--,a=n;a>=0;a--)r[a]=(a*e+(n-a)*t)/n;return r}var n,a,c,s,d,u,p=colorbrewer.PiYG[V],f=colorbrewer.RdBu[V];Bt=d3.scale.ordinal().domain(z.brainRegions).range(colorbrewer.Pastel1[7]),n=d3.min([d3.min(r.data,function(t){return d3.min(t,function(t){return t})}),d3.min(T.data,function(t){return d3.min(t,function(t){return t})})]),a=d3.max([d3.max(r.data,function(t){return d3.max(t,function(t){return t})}),d3.max(T.data,function(t){return d3.max(t,function(t){return t})})]),c=t(n,a),Ct=o.brainXLim,Ot=o.brainYLim,s=d3.min(H,function(t){return d3.min(t.data,function(t){return d3.min(t,function(t){return t})})}),d=d3.max(H,function(t){return d3.max(t.data,function(t){return d3.max(t,function(t){return t})})}),u=t(s,d),ht=d3.scale.linear().domain(c).range(p),zt?Lt=d3.scale.linear().domain(u).range(f):(f=[0,(V-1)/2,V-1].map(function(t){return f[t]}),Lt=d3.scale.ordinal().domain([-1,0,1]).range(f)),ft=d3.scale.ordinal().domain(xt).rangeBands([0,D]),gt=d3.scale.linear().domain(d3.extent(xt)).range([0,D]),mt=d3.scale.ordinal().domain(yt).rangeBands([j,0]),Pt=d3.scale.linear().domain(c).range(e(M,0,V)),timeSliceEdgeStatScale=d3.scale.linear().domain(u).range(e(M,0,V)),vt=d3.scale.linear().domain(Ct).range([0,l]),At=d3.scale.linear().domain(Ot).range([i,0]),Nt=d3.scale.linear().domain(u).range(e(0,j,V))}function G(){function t(t){return Math.max(W,Math.min(l-W,t.x))}function e(t){return Math.max(W,Math.min(i-W,t.y))}function n(t){var e=d3.select(this);S=e.style("stroke"),e.style("stroke-width",2*X).style("stroke",function(){return Lt(t.data<0?d3.min(Lt.domain()):d3.max(Lt.domain()))});d3.selectAll("circle.node").filter(function(e){return e.channelID===t.source.channelID||e.channelID===t.target.channelID}).attr("r",1.2*W)}function r(t){var e=d3.select(this);"undefined"!=typeof S&&(e.style("stroke-width",X).style("stroke",S),d3.selectAll("circle.node").filter(function(e){return e.channelID===t.source.channelID||e.channelID===t.target.channelID}).attr("r",W))}function d(t){var e=/\d+/;u=e.exec(t.source.channelID)[0],p=e.exec(t.target.channelID)[0],U=!0,c.select("text#HOLD").remove(),a(),r.call(this,t)}function x(t){var e=d3.select(this),n=B.indexOf(+t.channelID);if(n>-1?(e.selectAll("circle").attr("r",W),B.splice(n,1)):(e.selectAll("circle").attr("r",1.2*W),B.push(+t.channelID)),2===B.length){var r=/\d+/;u=r.exec(B[0])[0],p=r.exec(B[1])[0],U=!0,c.select("text#HOLD").remove(),d3.selectAll("circle.node").filter(function(t){return t.channelID===B[0].toString()||t.channelID===B[1].toString()}).attr("fill","#ddd").attr("r",W),B=[],a()}}function y(t){var e=!0;switch(zt||(e=0!==t.data),m){case"Within":e=t.source.region===t.target.region&&e;break;case"Between":e=t.source.region!==t.target.region&&e}return e}var v,A,b,S,w,k,D,I,L,_,B=[];Ft="Anatomical"===h?F.map(function(t){var e=pt(t);return e.x=vt(t.x),e.y=At(t.y),e.fixed=!0,e}):F.map(function(t,e){var n=pt(t);return"undefined"==typeof Ft?(n.x=vt(t.x),n.y=At(t.y)):(n.x=Ft[e].x,n.y=Ft[e].y,n.px=Ft[e].px,n.py=Ft[e].py),n.fixed=!1,n}),k=H.map(function(t){var e=pt(t);return e.source=Ft.filter(function(e){return e.channelID===t.source})[0],e.target=Ft.filter(function(e){return e.channelID===t.target})[0],e.data=e.data[g][f],e}),k=k.filter(y),bt=d3.layout.force().nodes(Ft).links(k).charge(-375).linkDistance(i/3).size([l,i]).start(),I=c.selectAll("g#BRAIN_IMAGE").data([{}]),I.enter().append("g").attr("id","BRAIN_IMAGE"),A=c.selectAll("g#EDGES").data([{}]),A.enter().append("g").attr("id","EDGES"),v=c.selectAll("g#NODES").data([{}]),v.enter().append("g").attr("id","NODES"),D=A.selectAll(".edge").data(k,function(t){return s+"_"+t.source.channelID+"_"+t.target.channelID}),D.enter().append("line").attr("class","edge").style("stroke-width",X).attr("x1",function(e){return t(e.source)}).attr("y1",function(t){return e(t.source)}).attr("x2",function(e){return t(e.target)}).attr("y2",function(t){return e(t.target)}),D.exit().remove(),D.style("stroke",function(t){return Lt(t.data)}).on("mouseover",n).on("mouseout",r).on("click",d),b=v.selectAll("g.gnode").data(Ft,function(t){return s+"_"+t.channelID}),b.enter().append("g").attr("class","gnode").attr("transform",function(n){return"translate("+[t(n),e(n)]+")"}).on("click",x),b.exit().remove(),L=b.selectAll("circle.node").data(function(t){return[t]}),L.enter().append("circle").attr("class","node").attr("r",W).attr("fill","#ddd").attr("opacity",1),L.attr("fill",function(t){return Bt(t.region)}).style("stroke","white"),L.filter(function(t){return t.channelID==u||t.channelID==p}).style("stroke","black"),_=b.selectAll("text.nodeLabel").data(function(t){return[t]}),_.enter().append("text").attr("class","nodeLabel").text(function(t){return t.channelID}),bt.on("tick",function(){b.attr("transform",function(n){return"translate("+[t(n),e(n)]+")"}),D.attr("x1",function(e){return t(e.source)}).attr("y1",function(t){return e(t.source)}).attr("x2",function(e){return t(e.target)}).attr("y2",function(t){return e(t.target)}),"Topological"!==h&&bt.stop()}),w=I.selectAll("image").data([o],function(t){return t.brainFilename}),"Anatomical"===h&&(w.enter().append("image").attr("width",l).attr("height",i),ut("DATA/brainImages/"+o.brainFilename,function(t,e){w.attr("xlink:href","data:image/png;base64,"+e)})),w.exit().remove(),"Topological"===h&&w.remove()}function Y(){function t(t){t.each(function(t){var d,u,p,f,g,m,h,x,y=d3.select(this);n.rangeBands([0,c]),a.rangeBands([i,0]),d=y.selectAll("g.heatmapX").data(t),d.enter().append("g").attr("transform",function(t,e){return"translate("+n(n.domain()[e])+", 0)"}).attr("class","heatmapX"),d.exit().remove(),u=d.selectAll("rect").data(function(t){return t}),u.enter().append("rect").attr("x",0).attr("y",function(t,e){return a(a.domain()[e])}).attr("height",a.rangeBand()).attr("width",n.rangeBand()).style("fill","white"),u.style("fill",function(t){return e(t)}).style("stroke",function(t){return e(t)}).on("mouseover",r).on("click",l),u.exit().remove(),p=d3.svg.axis().scale(n).orient("bottom").ticks(3).tickValues([d3.min(n.domain()),0,d3.max(n.domain())]).tickSize(0,0,0),f=d3.svg.axis().scale(a).orient("left").tickValues(["10","20","40","60","90","150","200"]).tickSize(0,0,0),m=y.selectAll("g.axis#x").data([{}]),m.enter().append("g").attr("class","axis").attr("id","x").attr("transform","translate(0,"+i+")").append("text").attr("x",n(0)).attr("y",0).attr("text-anchor","middle").attr("dy","2em").text(o),m.call(p),h=y.selectAll("g.axis#y").data([{}]),h.enter().append("g").attr("class","axis").attr("id","y").append("text").attr("x",-i/2).attr("dy","-2em").attr("transform","rotate(-90)").attr("text-anchor","middle").text(s),h.call(f),g=y.selectAll("g.zeroLine").data([[[0,i]]]),g.enter().append("g").attr("class","zeroLine"),x=g.selectAll("path").data(function(t){return t}),x.enter().append("path"),x.attr("d",d3.svg.line().x(n(0)).y(function(t){return t}).interpolate("linear")).attr("stroke","black").attr("stroke-width",2).attr("fill","none").style("opacity",.7)})}var e=d3.scale.linear(),n=d3.scale.ordinal(),a=d3.scale.ordinal(),r=function(){},l=function(){},i=500,c=500,o="",s="";return t.colorScale=function(n){return arguments.length?(e=n,t):e},t.xScale=function(e){return arguments.length?(n=e,t):n},t.yScale=function(e){return arguments.length?(a=e,t):a},t.rectMouseOver=function(e){return arguments.length?(r=e,t):r},t.rectMouseClick=function(e){return arguments.length?(l=e,t):l},t.width=function(e){return arguments.length?(c=e,t):c},t.height=function(e){return arguments.length?(i=e,t):i},t.yLabel=function(e){return arguments.length?(s=e,t):s},t.xLabel=function(e){return arguments.length?(o=e,t):o},t}function J(){function t(){var t=y.selectAll("g.title").data([Mt],function(t){return q+"-"+t.source+"-"+t.target});t.exit().remove(),t.enter().append("g").attr("transform","translate("+gt(0)+", -10)").attr("class","title");var e=t.selectAll("text.infoLabel").data(function(t){return[t]});e.enter().append("text").attr("class","infoLabel").attr("text-anchor","middle"),e.text(q+":");var n=e.node().getBBox(),a=t.selectAll("line.nodeLabel").data([{}]);a.enter().append("line").attr("class","edge").style("stroke-width",X).attr("stroke","black"),a.attr("x1",n.x+n.width+W).attr("y1",-W/2).attr("x2",n.x+n.width+W+30).attr("y2",-W/2);var r=t.selectAll("g").data([F.filter(function(t){return t.channelID===u}),F.filter(function(t){return t.channelID===p})]);r.enter().append("g"),r.attr("transform",function(t,e){return"translate("+(n.x+n.width+W+30*e)+", "+-W/2+")"});var l=r.selectAll("circle.node").data(function(t,e){return[[t,e]]});l.enter().append("circle").attr("class","node").attr("r",W).attr("fill","#ddd").attr("opacity",1),l.attr("fill",function(t){return Bt(t[0][0].region)});var i=r.selectAll("text.nodeLabel").data(function(t,e){return[[t,e]]});i.enter().append("text").attr("class","nodeLabel"),i.text(function(t){return t[0][0].channelID})}function e(t,e){var n=t.selectAll("g.title").data(F.filter(function(t){return t.channelID===e}),function(t){return t.SubjectID+"_"+t.channelID});n.exit().remove(),n.enter().append("g").attr("transform","translate("+gt(0)+", -10)").attr("class","title"),titleLabel=n.selectAll("text.infoLabel").data(function(t){return[t]}),titleLabel.enter().append("text").attr("class","infoLabel").attr("text-anchor","middle").text("Spectra: Ch");var a=titleLabel.node().getBBox(),r=n.selectAll("circle.node").data(function(t){return[t]});r.enter().append("circle").attr("class","node").attr("r",W).attr("transform","translate("+(-a.x+W+5)+", "+-W/2+")").attr("fill","#ddd").attr("opacity",1),r.attr("fill",function(t){return Bt(t.region)});var l=n.selectAll("text.nodeLabel").data(function(t){return[t]});l.enter().append("text").attr("class","nodeLabel").attr("transform","translate("+(-a.x+W+5)+", "+-W/2+")"),l.text(function(t){return t.channelID})}e(x,u),e(v,p),t(),S.text(q)}function Q(){var t,e,n=(d3.format(".1f"),C/(V+1)),a=.5*n;t=A.selectAll("g#powerLegend").data([{}]),t.enter().append("g").attr("id","powerLegend"),powerLegend=d3.legend.color().shape("rect").shapeWidth(n).shapeHeight(a).labelOffset(5).cells(V).orient("horizontal").scale(ht),t.call(powerLegend),e=b.selectAll("g#edgeStatLegend").data([{}]),e.enter().append("g").attr("id","edgeStatLegend"),edgeLegend=d3.legend.color().shape("rect").shapeWidth(n).shapeHeight(a).labelOffset(5).cells(V).orient("horizontal").scale(Lt),e.call(edgeLegend),anatomicalLegendG=w.selectAll("g#anatomicalLegend").data([{}]),anatomicalLegendG.enter().append("g").attr("id","anatomicalLegend"),anatomicalLegend=d3.legend.color().shape("circle").shapeRadius(W/2).labelOffset(5).orient("vertical").scale(Bt),anatomicalLegendG.call(anatomicalLegend)}function Z(){var t=k.selectAll("g#cohSlice").data([Mt.data.map(function(t){return t[f]})]);t.enter().append("g").attr("id","cohSlice"),t.call(Vt);var e=k.selectAll("g#spect1Slice").data([r.data.map(function(t){return t[f]})]);e.enter().append("g").attr("id","spect1Slice"),e.call(Wt);var n=k.selectAll("g#spect2Slice").data([T.data.map(function(t){return t[f]})]);n.enter().append("g").attr("id","spect2Slice"),n.call(Wt);var a=k.selectAll("text.title").data([yt[f]]);a.enter().append("text").attr("text-anchor","middle").attr("class","title").attr("x",O/2).attr("y",0).attr("dy","-1em"),a.text(function(t){return"Time Slice @ Frequency "+t+" "+z.funits})}function $(){function t(t){t.each(function(t){var u=d3.select(this);e.rangeBands([0,r]);var p="right"===s?1:-1,f=d3.svg.line().x(function(t,n){return e(e.domain()[n])}).y(function(t){return n(t)}).interpolate("linear"),g=u.selectAll("path.timeseries").data([t]);g.enter().append("path").attr("class","timeseries").attr("fill","none").attr("stroke",d),g.transition().duration(5).ease("linear").attr("d",f);var m=d3.svg.axis().scale(n).orient(s).ticks(3).tickValues([d3.min(n.domain()),0,d3.max(n.domain())]).tickSize(0,0,0),h=u.selectAll("g.axis#y").data([{}]);h.enter().append("g").attr("class","axis").attr("id","y").attr("transform","translate("+("right"===s?r:0)+",0)").append("text").attr("x",p*a/2).attr("dy","-2.5em").attr("transform","rotate("+90*p+")").attr("text-anchor","middle").text(o),h.call(m);var x=d3.svg.axis().scale(e).orient("bottom").ticks(3).tickValues([d3.min(e.domain()),0,d3.max(e.domain())]).tickSize(0,0,0),y=u.selectAll("g.axis#x").data([{}]);y.enter().append("g").attr("class","axis").attr("transform","translate(0,"+a+")").attr("id","x").append("text").attr("x",e(0)).attr("y",0).attr("text-anchor","middle").attr("dy","3em").text(c),y.call(x);var v=u.selectAll("g.zeroLine").data([[[0,a]]]);v.enter().append("g").attr("class","zeroLine");var A=v.selectAll("path").data(function(t){return t});A.enter().append("path"),A.attr("d",d3.svg.line().x(e(0)).y(function(t){return t}).interpolate("linear")).attr("stroke","black").attr("stroke-width",2).attr("fill","none").style("opacity",.7);var b=u.selectAll("g.heatmapX").data(t);b.enter().append("g").attr("transform",function(t,n){return"translate("+e(e.domain()[n])+", 0)"}).attr("class","heatmapX"),b.exit().remove();var S=b.selectAll("rect").data(function(t){return t});S.enter().append("rect").attr("opacity",1e-6).attr("height",a).attr("width",e.rangeBand()).style("fill","white"),S.on("mouseover",l).on("click",i),S.exit().remove()})}var e=d3.scale.ordinal(),n=d3.scale.linear(),a=600,r=600,l=function(){},i=function(){},c="",o="",s="left",d="blue";return t.xScale=function(n){return arguments.length?(e=n,t):e},t.yScale=function(e){return arguments.length?(n=e,t):n},t.rectMouseOver=function(e){return arguments.length?(l=e,t):l},t.rectMouseClick=function(e){return arguments.length?(i=e,t):i},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(a=e,t):a},t.yLabel=function(e){return arguments.length?(o=e,t):o},t.xLabel=function(e){return arguments.length?(c=e,t):c},t.yAxisOrientation=function(e){return arguments.length?(s=e,t):s},t.lineColor=function(e){return arguments.length?(d=e,t):d},t}function tt(){It=d3.select("#SubjectDropdown"),It.selectAll("li").on("click",function(){It.selectAll("button").text(this.id).append("span").attr("class","caret"),s=this.id,u="",p="",e()})}function et(){_t=d3.select("#EdgeStatTypeDropdown"),_t.selectAll("li").on("click",function(){_t.selectAll("button").text(d3.select(this).select("a").html()).append("span").attr("class","caret"),d=this.id,Tt=P.filter(function(t){return t.edgeStatID===d})[0].isFreq,f=Tt?f:0,wt.property("value",yt[f]),Dt.text(yt[f]+" Hz"),n()})}function nt(){I=d3.select("#EdgeFilterDropdown"),I.selectAll("li").on("click",function(){I.selectAll("button").text(this.id).append("span").attr("class","caret"),m=this.id,G()})}function at(){var t=d3.select("#NetworkViewPanel");t.selectAll("input").on("click",function(){var e=this.value;t.selectAll("input").property("checked",!1),d3.select(this).property("checked",!0),h=e,G()})}function rt(){var t=d3.select("#playButton");t.on("click",function(){d3.select("#playButton").text("Stop"),K=!K;var t=setInterval(function(){jt>g&&K===!1?(g++,it.call({value:xt[g]})):(d3.select("#playButton").text("Start"),K=!0,clearInterval(t))},100)})}function lt(){var t=d3.select("#resetButton");t.on("click",function(){g=0,K=!0,it.call({value:xt[g]})})}function it(){g=xt.indexOf(+this.value),St.property("value",xt[g]),kt.text(xt[g]+" ms"),this.noUpdate||G()}function ct(){f=Tt?yt.indexOf(+this.value):0,wt.property("value",yt[f]),Dt.text(yt[f]+" Hz"),this.noUpdate||G(),Tt&!this.noUpdate&&Z()}function ot(t,e,n){U&&(f=Tt?e:0,g=n,it.call({value:xt[g],noUpdate:!0}),ct.call({value:yt[f]}))}function st(){U=!U,U?(c.select("text#HOLD").remove(),bt.start()):(c.append("text").attr("x",l).attr("y",i).attr("text-anchor","end").attr("id","HOLD").text("HOLD"),bt.stop())}function dt(t){for(var e=new Uint8Array(t),n=e.length,a=[];n--;)a[n]=String.fromCharCode(e[n]);var r=window.btoa(a.join(""));return r}function ut(t,e){var n,a=new XMLHttpRequest(t);a.open("GET",t,!0),a.responseType="arraybuffer",a.callback=e,a.onload=function(){n=dt(this.response),this.callback(null,n)},a.onerror=function(){e("B64 ERROR",null)},a.send()}function pt(t){var e={};for(var n in t)e[n]=t[n];return e}var ft,gt,mt,ht,xt,yt,ht,vt,At,bt,St,wt,kt,Dt,It,Lt,_t,Bt,Et,jt,Ct,Ot,Mt,Pt,ht,Lt,Tt,zt,Nt,qt,Ft;xt=z.tax,yt=z.fax,Mt=H.filter(function(t){return t.source===u&&t.target===p||t.source===p&&t.target===u})[0],qt=P.filter(function(t){return t.edgeStatID===d})[0],Tt=qt.isFreq,zt=qt.isWeightedNetwork,R(),N();var Ht=Y().height(j).width(D).yScale(mt).xScale(ft).xLabel("Time ("+z.tunits+")").yLabel("Frequency ("+z.funits+")").colorScale(ht).rectMouseOver(ot).rectMouseClick(st),Rt=Y().height(j).width(D).yScale(mt).xScale(ft).xLabel("Time ("+z.tunits+")").yLabel("Frequency ("+z.funits+")").colorScale(Lt).rectMouseOver(ot).rectMouseClick(st),Gt=$().height(j).width(D).yScale(Nt).xScale(ft).xLabel("Time ("+z.tunits+")").yLabel(q).rectMouseOver(ot).rectMouseClick(st),Vt=$().height(M).width(O).yScale(timeSliceEdgeStatScale).xScale(ft).yAxisOrientation("left").xLabel("Time ("+z.tunits+")").yLabel(q),Wt=$().height(M).width(O).yScale(Pt).xScale(ft).yAxisOrientation("right").xLabel("Time ("+z.tunits+")").yLabel("Power Difference").lineColor("green");G(),c.style("display",""),L.stop(),x.datum(r.data).call(Ht),x.style("display",""),_.stop(),v.datum(T.data).call(Ht),B.stop(),v.style("display",""),Tt?(y.html(""),y.datum(Mt.data).call(Rt),Z()):(y.html(""),k.html(""),y.datum(Mt.data).call(Gt)),y.style("display",""),E.stop(),k.style("display",""),J(),Q(),tt(),et(),nt(),at(),rt(),lt()}spectraVis={},params={};var l,i,c,o,s,d,u,p,f,g,m,h,x,y,v,A,b,S,w,k,D,I,L,_,B,E,D,j,C,O,M,P,T,z,N,q,F,H,R,G,V=11,W=10,X=2,K=!0,U=!0;colorbrewer.PiYG[V].reverse(),colorbrewer.RdBu[V].reverse(),spectraVis.init=function(e){N={top:30,right:30,bottom:30,left:30},D=document.getElementById("SpectraCh1Panel").offsetWidth-N.left-N.right,j=.8*document.getElementById("SpectraCh1Panel").offsetWidth-N.top-N.bottom,C=document.getElementById("legendKey").offsetWidth-5-5-30;100-N.top-N.bottom;O=D,M=180-N.top-N.bottom;var n={zIndex:100};G=+e.freq,R=+e.time,m=e.edgeFilter||"All",h=e.networkView||"Anatomical",u=e.curCh1,p=e.curCh2,s=e.curSubject,d=e.edgeStatID,x=d3.select("#SpectraCh1Panel").append("svg").attr("width",D+N.left+N.right).attr("height",j+N.top+N.bottom).append("g").attr("transform","translate("+N.left+","+N.top+")"),y=d3.select("#EdgeStatPanel").append("svg").attr("width",D+N.left+N.right).attr("height",j+N.top+N.bottom).append("g").attr("transform","translate("+N.left+","+N.top+")"),v=d3.select("#SpectraCh2Panel").append("svg").attr("width",D+N.left+N.right).attr("height",j+N.top+N.bottom).append("g").attr("transform","translate("+N.left+","+N.top+")"),A=d3.selectAll("#legendKey").select("#spectraLegend").append("svg").attr("width",C+5+5).attr("height",50).append("g").attr("transform","translate(5,25)"),A.append("text").attr("transform","translate(-5, -5)").attr("font-size",12).attr("font-weight",700).text("Difference in Power"),b=d3.selectAll("#legendKey").select("#edgeStatLegend").append("svg").attr("width",C+5+5).attr("height",50).append("g").attr("transform","translate(5,25)"),S=b.append("text").attr("transform","translate(-5, -5)").attr("font-size",12).attr("font-weight",700).text("Edge Statistic"),w=d3.selectAll("#legendKey").select("#anatomicalLegend").append("svg").attr("width",C+5+5).append("g").attr("transform","translate(5,25)"),w.append("text").attr("transform","translate(-5, -10)").attr("font-size",12).attr("font-weight",700).text("Brain Areas"),k=d3.select("#timeSlice").append("svg").attr("width",O+40+40).attr("height",M+40+40).append("g").attr("transform","translate(40,40)");var a=d3.select("#overlay"),r=d3.select("button#help-button");a.selectAll(".close").on("click",function(){a.style("display","none")}),r.on("click",function(){a.style("display","block")});var l=d3.select("#permalink"),i=d3.select("button#link");i.on("click",function(){l.style("display","block");var t=window.location.origin+window.location.pathname+"?curSubject="+s+"&edgeStatID="+d+"&edgeFilter="+m+"&networkView="+h+"&time="+z.tax[g]+"&freq="+z.fax[f]+"&curCh1="+u+"&curCh2="+p;l.selectAll("textarea").html(t),l.selectAll(".bookmark").attr("href",t)}),l.selectAll(".close").on("click",function(){l.style("display","none")});var c=d3.select("button#export");c.on("click",function(){var t=d3.select("#NetworkPanel").select("svg").node(),e="Network_"+s+"_"+d+"_"+h+"_"+z.tax[g]+z.tunits+"_"+z.fax[f]+z.funits;d3_save_svg.save(t,{filename:e});var n="Spectra_"+s+"_Ch"+u,a=d3.select("#SpectraCh1Panel").select("svg").node();d3_save_svg.save(a,{filename:n});var r="Spectra_"+s+"_Ch"+p,l=d3.select("#SpectraCh2Panel").select("svg").node();d3_save_svg.save(l,{filename:r});var i=d+"_"+s+"_Ch"+u+"_Ch"+p,c=d3.select("#EdgeStatPanel").select("svg").node();d3_save_svg.save(c,{filename:i}),d3.selectAll("circle.node")[0].forEach(function(t){t.setAttribute("style","")})}),I=d3.select("#EdgeFilterDropdown"),I.selectAll("button").text(m).append("span").attr("class","caret"),L=new Spinner(n),_=new Spinner(n),B=new Spinner(n),E=new Spinner(n),queue().defer(d3.json,"DATA/subjects.json").defer(d3.json,"DATA/visInfo.json").defer(d3.json,"DATA/edgeTypes.json").await(t)}}();